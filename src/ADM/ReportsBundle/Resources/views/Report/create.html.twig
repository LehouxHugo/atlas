{# OffCanvas Layout | http://webapplayers.com/inspinia_admin-v2.1/off_canvas_menu.html #}
{% extends "ADMCoreBundle::OffCanvasLayout.html.twig" %}

{% block title %}
{% endblock %}

{% block stylesheets %}
    {% stylesheets output="css/compiled/addReport.css" filter="cssrewrite"
    'bundles/admcore/css/bootstrap.min.css'
    'bundles/admcore/font-awesome/css/font-awesome.css'
    'bundles/admcore/css/style.css'
    'bundles/admcore/css/animate.css'
    'bundles/admcore/css/plugins/chosen/chosen.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
    {{ form_stylesheet(form) }}
{% endblock %}

{% block extraheadcontent %}
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
    <style>
        #map { height:70vh; width:100%; margin-bottom: 15px; }
    </style>


{% endblock %}

{% block bodyclass %}
    "skin-3 mini-navbar"
{% endblock %}

{% block closeNavbar %}
{% endblock %}

{% block menus %}
    {{ parent() }}
{% endblock %}

{% block pagewrapperclass %}
    {{ parent() }}
{% endblock %}

{% block navbarclass %}
    {{ parent() }}
{% endblock %}

{% block topnav %}
    {{ parent() }}
{% endblock %}

{% block dashboardheader %}
{% endblock %}

{% block breadcrumb %}
    <h2>Ajouter une Ã©tude</h2>
    <ol class="breadcrumb">
        <li>
            <a href="{{ path('adm_core_home') }}">Accueil</a>
        </li>
        <li>
            <a href="#">Rapports</a>
        </li>
        <li class="active">
            <strong>Ajouter</strong>
        </li>
    </ol>
{% endblock %}

{% block wrappercontentclass %}
    "wrapper wrapper-content animated fadeInRight article"
{% endblock %}

{% block pagecontent %}

    {{ include('ADMReportsBundle:Report:formReportType.html.twig') }}

{% endblock %}

{% block footerclass %}
    {{ parent() }}
{% endblock %}

{% block plugins %}
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {% javascripts
    '@ADMCoreBundle/Resources/public/js/jquery-2.1.1.js'
    '@ADMCoreBundle/Resources/public/js/bootstrap.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/metisMenu/jquery.metisMenu.js'
    '@ADMCoreBundle/Resources/public/js/plugins/pace/pace.min.js'
    '@ADMCoreBundle/Resources/public/js/inspinia.js'
    '@ADMCoreBundle/Resources/public/js/plugins/toastr/toastr.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/slimscroll/jquery.slimscroll.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/flot/jquery.flot.js'
    '@ADMCoreBundle/Resources/public/js/plugins/flot/jquery.flot.tooltip.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/flot/jquery.flot.spline.js'
    '@ADMCoreBundle/Resources/public/js/plugins/flot/jquery.flot.resize.js'
    '@ADMCoreBundle/Resources/public/js/plugins/flot/jquery.flot.pie.js'
    '@ADMCoreBundle/Resources/public/js/plugins/peity/jquery.peity.min.js'
    '@ADMCoreBundle/Resources/public/js/demo/peity-demo.js'
    '@ADMCoreBundle/Resources/public/js/plugins/jquery-ui/jquery-ui.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/sparkline/jquery.sparkline.min.js'
    '@ADMCoreBundle/Resources/public/js/demo/sparkline-demo.js'
    '@ADMCoreBundle/Resources/public/js/plugins/chartJs/Chart.min.js'
    '@ADMCoreBundle/Resources/public/js/plugins/chosen/chosen.jquery.js'
    output='js/compiled/addReport.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    {{ form_javascript(form) }}
{% endblock %}

{% block extrascripts %}
    {{ parent() }}



    <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoiaHVnb2xlaG91eCIsImEiOiItOHl6Sm5jIn0.12l_k0K_Z28UE-Jc0kDgpw';
        {% block mapscript %}
        var map = L.mapbox.map('map', 'examples.map-igb471ik')
                .setView([0, 0], 2);
        {% endblock %}
        var latitude = document.getElementById('adm_reportsbundle_report_latitude');
        var longitude = document.getElementById('adm_reportsbundle_report_longitude');

        var marker = L.marker([0, 0], {
            icon: L.mapbox.marker.icon({
                'marker-color': '#7DC8B0'
            }),
            draggable: true
        }).addTo(map);

        // every time the marker is dragged, update the coordinates container
        marker.on('dragend', ondragend);

        // Set the initial marker coordinate on load.
        ondragend();

        function ondragend() {
            var m = marker.getLatLng();
            latitude.value = m.lat;
            longitude.value = m.lng;

            latI = document.getElementById('adm_reportsbundle_report_latitude').value;
            lngI = document.getElementById('adm_reportsbundle_report_longitude').value;

            $.ajax({
                url: "http://ws.geonames.org/countryCode",
                type: 'get',
                dataType: "html",
                data: {
                    username: "hugolehoux",
                    lat: latI,
                    lng: lngI
                },
                success: function (result) {
                    document.getElementById('adm_reportsbundle_report_country').value = result;
                },
                error : function(result, statut, erreur){
                    document.getElementById('adm_reportsbundle_report_country').value = "";
                }
            });
        }

    </script>

    <script type="text/javascript">
        $("select").chosen();
    </script>

    {{ tinymce_init() }}
{% endblock %}