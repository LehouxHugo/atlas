{# OffCanvas Layout | http://webapplayers.com/inspinia_admin-v2.1/off_canvas_menu.html #}
{% extends "ADMCoreBundle::OffCanvasLayout.html.twig" %}

{% block title %}
{% endblock %}

{% block stylesheets %}
    {% stylesheets output="css/compiled/countryRead.css" filter="cssrewrite"
    'bundles/admcore/css/bootstrap.min.css'
    'bundles/admcore/font-awesome/css/font-awesome.css'
    'bundles/admcore/css/plugins/dataTables/dataTables.bootstrap.css'
    'bundles/admcore/css/plugins/dataTables/dataTables.responsive.css'
    'bundles/admcore/css/plugins/dataTables/dataTables.tableTools.min.css'
    'bundles/admcore/css/style.css'
    'bundles/admcore/css/animate.css'
    'bundles/admcore/css/plugins/toastr/toastr.min.css' %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block extraheadcontent %}
    <style>
        .static-map {
            width: 100%;

        }


    </style>

    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet'/>




{% endblock %}

{% block bodyclass %}
    "skin-3"
{% endblock %}
{# Options du bodyclass : "skin-1"  "skin-2" "skin-3" "mini-navbar" "fixed-sidebar" : dans ce cas ne pas oublier d'ajouter le script slimScroll qui se trouve dans js/inspinia.js file et décommenter le Fixed Sidebar comment and uncomment function et ajouter <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>"fixed-nav" : dans ce cas mettre navbar-fixed-top si body class = fixed-nav dans <nav>   En mettant mini-navbar ET fixed-sidebar ET fixed-nav, on ne voit plus du tout la barre de navigation de gauche et la barre du haut devient fixe (pour Rapports de stage peut-être), "canvas-menu"pour le OffCanvasLayout #}

{% block closeNavbar %}
{% endblock %}
{# Ajouter <a class="close-canvas-menu"><i class="fa fa-times"></i></a> si bodyclass=canvas-menu #}

{% block menus %}
    {{ parent() }}
{% endblock %}

{% block pagewrapperclass %}
    {{ parent() }}
{% endblock %}
{# Options du pagewrapperclass : "gray-bg" "gray-bg dashboard-1" mais ça a pas l'air de servir grand chose "gray-bg sidebar-content" ajoute une jolie barre sur la droite  (peut-être pour mettre le sommaire des rapports). Par contre pas toujours terrible pour les téléphones car elle est prioritaireIl faut créer un <div class="sidebard-panel">. Voir exemple #}

{% block navbarclass %}
    {{ parent() }}
{% endblock %}
{# "navbar navbar-static-top" ou "navbar-fixed-top" si body class = fixed-nav #}

{% block topnav %}
    {{ parent() }}
{% endblock %}

{# On met soit le block dashboardheader ou pageheading mais pas les deux, on peut aussi les enlever tous les deux. Je mets du contenu pour l'exemple #}
{% block dashboardheader %}
{% endblock %}


{% block breadcrumb %}
    <h2>{{ country.name }}</h2>
    <ol class="breadcrumb">
        <li>
            <a href="{{ path('adm_core_home') }}">Accueil</a>
        </li>
        <li>
            <a href="#">Pays</a>
        </li>
        <li>
            <strong>{{ country.name }}</strong>
        </li>
    </ol>
{% endblock %}

{% block wrappercontentclass %}
    "wrapper wrapper-content"
{% endblock %}
{# Options du pagewrapperclass : "wrapper wrapper-content" "wrapper wrapper-content animated fadeInRight" voire "wrapper wrapper-content animated fadeInRight article" pour faire apparaître le contenu de façon un peu dynamique (voir animate.css pour toutes les options) #}

{% block pagecontent %}
    <div class="row animated fadeInRight">

        <div class="col-md-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>{{ country.name }}</h5>

                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">



                </div>
            </div>

        </div>
        <div class="col-md-4">
            <div class="ibox float-e-margins">
                <div>
                    <div class="ibox-content no-padding border-left-right">
                        <img class="static-map" id='static-map'>
                    </div>
                    <div class="ibox-content profile-content">
                        <a href="http://faostat3.fao.org/browse/area/{{ country.numericCountryCode }}/E">Statistiques du
                            pays sur FAOStat</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered table-hover dataTables-example" id="YTDSummary">

            </table>
        </div>
    </div>
{% endblock %}

{% block footerclass %}
    {{ parent() }}
{% endblock %}
{# Options du footerclass : "footer" "footer fixed" #}

{% block plugins %}
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript" src="http://www.ok-soft-gmbh.com/jqGrid/OK/i18n/grid.locale-en.js"></script>
    <script type="text/javascript" src="http://www.ok-soft-gmbh.com/jqGrid/OK/jquery.jqgrid.src.js"></script>
{% endblock %}

{% block extrascripts %}
    <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoiaHVnb2xlaG91eCIsImEiOiItOHl6Sm5jIn0.12l_k0K_Z28UE-Jc0kDgpw';
        longitude = {{ country.latitude }};
        latitude = {{ country.longitude }};
        var data = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            latitude,
                            longitude
                        ]
                    }
                }
            ]
        };

        // The size of the desired map.
        var size = [600, 600];


        document.getElementById('static-map').src =
                'https://api.tiles.mapbox.com/v4/hugolehoux.m2a2l7dj/' +
                'pin-l+C5E96F(' + latitude + ',' + longitude + ')' + '/' +
                latitude + ',' + longitude + ',' +
                3 + '/' +
                size.join('x') + '.png' +
                '?access_token=' + L.mapbox.accessToken;
    </script>

    <script>
        var mydata = {{ FAOdata | raw }};

        mydata.forEach(function (record) {
                    record.year = record.year.toString();
                    console.log(record.year);
                }
        );


        jQuery("#YTDSummary").jqGrid('jqPivot', mydata,
                {
                    xDimension: [{
                        dataName: 'Item',
                        label: 'Item',
                        width: 50
                    }],
                    yDimension: [{
                        dataName: 'year'
                    }],
                    aggregates: [{
                        label: 'Production',
                        member: 'Production',
                        name: 'Production',
                        aggregator: 'sum',
                        width: 40,
                        formatter: 'number',
                        align: 'right',
                        summaryType: 'sum'
                    }],
                    rowTotals: true,
                    colTotals: true
                }, {
                    loadComplete: function () {
                        reSizeGrid();
                    }
                }, {
                    cmTemplate: {
                        autoResizable: true
                    },
                    autoResizing: {
                        compact: true
                    },
                    autoresizeOnLoad: true,
                    shrinkToFit: false,
                    //width: 600,
                    //height: "auto",
                    rowNum: 10,
                    iconSet: "fontAwesome",
                    pager: true,
                    caption: "Atlas",
                    onInitGrid: function () {
                        var p = $(this).jqGrid("getGridParam");

                        p.datastr = $.grep(p.datastr, function (item) {
                            return item.ComponentType !== "";
                        });
                    },
                    rowattr: function (rd) {
                        if (rd.parent === "null") { //  && rd.name === "Cash"
                            return {
                                class: "myMarking"
                            };
                        }
                    }
                });

        function reSizeGrid() {
            jQuery("#YTDSummary").setGridWidth(1200, true);
            jQuery("#YTDSummary").setGridHeight(800, true);

        }
    </script>

    <script>
        $(document).ready(function () {
            $('.ui-jqgrid-htable').dataTable({
                responsive: true,
                "dom": 'T<"clear">lfrtip',
                "tableTools": {
                    "sSwfPath": "http://cdn.datatables.net/tabletools/2.2.2/swf/copy_csv_xls_pdf.swf"
                }
            });
        });
    </script>

    <style>
        body.DTTT_Print {
            background: #fff;

        }

        .DTTT_Print #page-wrapper {
            margin: 0;
            background: #fff;
        }

        button.DTTT_button, div.DTTT_button, a.DTTT_button {
            border: 1px solid #e7eaec;
            background: #fff;
            color: #676a6c;
            box-shadow: none;
            padding: 6px 8px;
        }

        button.DTTT_button:hover, div.DTTT_button:hover, a.DTTT_button:hover {
            border: 1px solid #d2d2d2;
            background: #fff;
            color: #676a6c;
            box-shadow: none;
            padding: 6px 8px;
        }

        .dataTables_filter label {
            margin-right: 5px;

        }
    </style>
{% endblock %}

