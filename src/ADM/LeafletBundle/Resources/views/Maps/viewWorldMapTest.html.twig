{% extends "ADMCoreBundle::OutlookLayout.html.twig" %}

{% block extraheadcontent %}
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.9/mapbox.css' rel='stylesheet' />

  <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
  <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

  <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-zoomslider/v0.7.0/L.Control.Zoomslider.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-zoomslider/v0.7.0/L.Control.Zoomslider.css' rel='stylesheet' />

  <style type="text/css">
    #map{
      width: 100%;
      height: calc(100vh - 100px);
    }
  </style>
{% endblock %}

{% block pageheadingstyle %}style="padding-top:10px;padding-bottom:10px;"{% endblock %}
  {% block breadcrumb %}
    <ol class="breadcrumb" >
      <li>
        <a href="{{ path('adm_core_home')}}">Accueil</a>
      </li>
      <li>
        <a>Atlas</a>
      </li>
      <li class="active">
        <strong>Mappemonde</strong>
      </li>
    </ol>
  {% endblock %}

  {% block firstColumn %}
    <li class="list-group-item active">
      <a href="#">
        <small class="pull-right text-muted"> 16.02.2015</small>
        <strong>Ann Smith</strong>
        <div class="small m-t-xs">
          <p>
            Survived not only five centuries, but also the leap scrambled it to make.
          </p>
          <p class="m-b-none">
            <i class="fa fa-map-marker"></i> Riviera State 32/106
          </p>
        </div>
      </a>
    </li>
    <li class="list-group-item">
      <a href="#">
        <small class="pull-right text-muted"> 11.10.2015</small>
        <strong>Paul Morgan</strong>
        <div class="small m-t-xs">
          <p class="m-b-xs">
            There are many variations of passages of Lorem Ipsum.
            <br/>
          </p>
          <p class="m-b-none">
            <span class="label pull-right label-primary">SPECIAL</span>
            <i class="fa fa-map-marker"></i> California 10F/32
          </p>
        </div>
      </a>
    </li>
    <li class="list-group-item">
      <a href="#">
        <small class="pull-right text-muted"> 08.04.2015</small>
        <strong>Michael Jackson</strong>
        <div class="small m-t-xs">
          <p class="m-b-xs">
            Look even slightly believable. If you are going to use a passage of.
          </p>
          <p class="m-b-none">
            <i class="fa fa-map-marker"></i> Berlin 120R/15
          </p>
        </div>
      </a>
    </li>
  {% endblock %}

  {% block secondColumn %}
    <div id='map'></div>
    <script>
      L.mapbox.accessToken = 'pk.eyJ1IjoiaHVnb2xlaG91eCIsImEiOiItOHl6Sm5jIn0.12l_k0K_Z28UE-Jc0kDgpw';
      var map = L.mapbox.map('map', 'examples.map-igb471ik', {
        zoomControl: false
      }).setView([18, 22.5], 2)
      var markers = L.markerClusterGroup();
      var myLayer = L.mapbox.featureLayer();

      var geoJson = [
      {% for report in listReports %}
      {
        type: 'Feature',
        "geometry": {
          "type": "Point",
          "coordinates": [{{ report.longitude }},{{ report.latitude}}]
        },
        "properties": {
          "url": "{{ url('adm_report_view', { 'slug': report.slug }) }}",
          "marker-symbol": "star",
          "marker-color": "#ff8888",
          "marker-size": "large",
          "title": "{{ report.title }}",
          "author": "{{ report.author }}",
          "date": "{{ report.date | date('m/y') }}"
        }
      }{% if not loop.last %},{% endif %}
      {% endfor %}
      ];

// Add custom popups to each using our custom feature properties
myLayer.on('layeradd', function (e) {
  var marker = e.layer,
  feature = marker.feature;

    // Create custom popup content
    var popupContent = '<a target="_blank" class="popup" href="' + feature.properties.url + '">' + feature.properties.title +
    '</a>';

    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent, {
      closeButton: true,
      minWidth: 320
    });
  });

myLayer.on('mouseover', function(e) {
  e.layer.openPopup();
});
myLayer.on('mouseout', function(e) {
  e.layer.closePopup();
});
// Add features to the map
myLayer.setGeoJSON(geoJson);
markers.addLayer(myLayer);
map.addLayer(markers);
</script>
{% endblock %}

{% block extrascripts %}
  {{ parent() }}


{% endblock %}